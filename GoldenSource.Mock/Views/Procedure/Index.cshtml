@{
    ViewData["Title"] = "Procédures";
}

<div class="container-fluid">
    <div class="row mb-4">
        <div class="col">
            <h2>Procédures</h2>
        </div>
        <div class="col text-right">
            <button class="btn btn-primary" id="create-procedure">
                <i class="fas fa-plus"></i> Nouvelle Procédure
            </button>
        </div>
    </div>

    <div class="row">
        <div class="col-md-3">
            <div class="card">
                <div class="card-header">
                    Filtres
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label>Département</label>
                        <select class="form-control" id="department-filter">
                            <option value="">Tous</option>
                            <option value="Réseau">Réseau</option>
                            <option value="Opérations">Opérations</option>
                            <option value="Cartes">Cartes</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Niveau d'accès</label>
                        <select class="form-control" id="access-level-filter">
                            <option value="">Tous</option>
                            <option value="1">Niveau 1</option>
                            <option value="2">Niveau 2</option>
                            <option value="3">Niveau 3</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Statut</label>
                        <select class="form-control" id="status-filter">
                            <option value="">Tous</option>
                            <option value="active">Active</option>
                            <option value="archived">Archivée</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-9">
            <div class="card">
                <div class="card-body">
                    <div class="input-group mb-3">
                        <input type="text" class="form-control" id="search-input" placeholder="Rechercher une procédure...">
                        <div class="input-group-append">
                            <button class="btn btn-outline-secondary" type="button" id="search-button">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </div>

                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Titre</th>
                                    <th>Département</th>
                                    <th>Niveau d'accès</th>
                                    <th>Date de création</th>
                                    <th>Statut</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="procedures-table">
                                <!-- Les procédures seront injectées ici -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            // Charger les procédures
            loadProcedures();

            // Gestionnaires d'événements
            $('#search-button').click(function() {
                loadProcedures();
            });

            $('#department-filter, #access-level-filter, #status-filter').change(function() {
                loadProcedures();
            });

            $('#create-procedure').click(function() {
                // Simuler l'ouverture du formulaire de création
                alert('Ouverture du formulaire de création de procédure');
            });

            function loadProcedures() {
                // Simuler le chargement des procédures
                const procedures = [
                    {
                        id: 1,
                        title: "Procédure d'ouverture de compte particulier",
                        department: "Réseau",
                        accessLevel: 1,
                        creationDate: "2024-02-15",
                        status: "active"
                    },
                    {
                        id: 2,
                        title: "Procédure de virement SEPA",
                        department: "Opérations",
                        accessLevel: 1,
                        creationDate: "2024-02-10",
                        status: "active"
                    }
                ];

                const tbody = $('#procedures-table');
                tbody.empty();

                procedures.forEach(procedure => {
                    const tr = $('<tr>');
                    tr.append(`<td>${procedure.title}</td>`);
                    tr.append(`<td>${procedure.department}</td>`);
                    tr.append(`<td>${procedure.accessLevel}</td>`);
                    tr.append(`<td>${procedure.creationDate}</td>`);
                    tr.append(`<td><span class="badge badge-${procedure.status === 'active' ? 'success' : 'secondary'}">${procedure.status}</span></td>`);
                    tr.append(`
                        <td>
                            <button class="btn btn-sm btn-info" onclick="viewProcedure(${procedure.id})">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-warning" onclick="editProcedure(${procedure.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteProcedure(${procedure.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `);
                    tbody.append(tr);
                });
            }

            // Fonctions globales pour les actions
            window.viewProcedure = function(id) {
                alert(`Visualisation de la procédure ${id}`);
            };

            window.editProcedure = function(id) {
                alert(`Modification de la procédure ${id}`);
            };

            window.deleteProcedure = function(id) {
                if (confirm('Êtes-vous sûr de vouloir supprimer cette procédure ?')) {
                    alert(`Suppression de la procédure ${id}`);
                }
            };
        });
    </script>

    <style>
        .table th {
            background-color: #f8f9fa;
        }

        .badge {
            font-size: 0.9em;
        }

        .btn-sm {
            margin-right: 0.25rem;
        }
    </style>
} 